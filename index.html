<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Untitled</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="th">
<head>
    <title>Rx Selection - Online System</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: 'Helvetica Neue', Arial, sans-serif; text-align: center; padding: 20px; background-color: #f4f7f6; color: #333; }
        .container { max-width: 1100px; margin: auto; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: 20px; }
        
        /* Dashboard */
        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-top: 20px; }
        .stat-box { padding: 18px; border-radius: 12px; border: 2px solid #e0e0e0; background: #fff; text-align: left; }
        .stat-name { font-weight: bold; color: #2c3e50; border-bottom: 3px solid #3498db; padding-bottom: 8px; margin-bottom: 12px; }
        .section-1 { background-color: #fff5f5; border-left: 4px solid #e74c3c; padding: 5px; margin-bottom: 8px; border-radius: 6px; }
        .section-2 { background-color: #f0f7ff; border-left: 4px solid #3498db; padding: 5px; border-radius: 6px; }
        .group-tag { display: inline-block; background: white; border: 1px solid #ddd; padding: 3px 10px; margin: 3px; border-radius: 15px; font-size: 13px; font-weight: bold; }
        
        /* Selection Area */
        .btn-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-top: 20px; }
        .btn-ajarn { padding: 15px 10px; border-radius: 10px; border: 2px solid #ddd; background: white; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-ajarn:hover { border-color: #3498db; }
        .btn-selected-1 { border-color: #e74c3c !important; background: #fff5f5; color: #e74c3c; }
        
        /* Inputs & Buttons */
        input { width: 180px; padding: 15px; border-radius: 10px; border: 2px solid #ddd; font-size: 18px; text-align: center; }
        .btn-main { padding: 15px 40px; background-color: #2ecc71; color: white; cursor: pointer; border: none; font-size: 18px; font-weight: bold; border-radius: 10px; margin-top: 15px; }
        .loading-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.9); z-index:1000; padding-top:20%; font-weight:bold; font-size: 24px; color: #3498db; }
        
        #selection-area, #result-msg { display: none; }
    </style>
</head>
<body>

<div id="loading" class="loading-overlay">‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå ‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...</div>

<div class="container">
    <div class="card">
        <h2>üìä ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå (Real-time)</h2>
        <button onclick="loadOnlineData()" style="background:none; border:1px solid #ccc; border-radius:5px; cursor:pointer; padding:5px 10px; font-size:12px;">üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</button>
        <div id="dashboard" class="dashboard-grid"></div>
    </div>

    <div class="card">
        <div id="auth-area">
            <h3>üî¢ ‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h3>
            <input type="number" id="groupNumber" placeholder="‡πÄ‡∏•‡∏Ç‡∏Å‡∏•‡∏∏‡πà‡∏°" min="1">
            <br>
            <button class="btn-main" onclick="startSelection()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</button>
        </div>

        <div id="selection-area">
            <p>‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ <strong>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà: <span id="current-group-display" style="font-size: 24px; color: #e74c3c;"></span></strong> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
            <div id="step-instruction" style="padding:15px; border-radius:8px; font-weight:bold; margin-bottom:15px;"></div>
            
            <div class="btn-grid" id="ajarn-buttons"></div>
            <br>
            <button id="confirm-btn" class="btn-main" style="background-color: #34495e; display:none;" onclick="finalSubmit()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô Cloud</button>
        </div>

        <div id="result-msg">
            <h3 style="color: #27ae60;">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h3>
            <button class="btn-main" style="background-color: #34495e;" onclick="resetForm()">‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ñ‡∏±‡∏î‡πÑ‡∏õ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </div>
</div>

<script>
    // ‚ö†Ô∏è ‡∏ô‡∏≥ URL ‡∏à‡∏≤‡∏Å Google Apps Script ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡∏Ñ‡∏≥‡∏û‡∏π‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxVdXkRgde6Oo0-KVkUifrUPnD_REdiwr_30NsfrxgviY4yoBfwDJnvAoIvz02hks_y-w/exec";

    const ajarnList = ["‡∏≠‡∏à.‡∏£‡∏±‡∏ê‡∏û‡∏•", "‡∏≠‡∏à.‡∏õ‡∏Å‡∏£‡∏ì‡πå", "‡∏≠‡∏à.‡∏ô‡∏°‡∏ô‡∏ï‡πå", "‡∏≠‡∏à.‡∏®‡∏£‡∏µ‡∏ß‡∏£‡∏£‡∏ì", "‡∏≠‡∏à.‡πÄ‡∏Å‡∏®‡∏¥‡∏ì‡∏µ", "‡∏≠‡∏à.‡∏≠‡∏£‡∏†‡∏≤", "‡∏≠‡∏à.‡∏•‡∏•‡∏ô‡∏≤", "‡∏≠‡∏à.‡∏™‡∏∏‡∏†‡∏≤‡∏ß‡∏î‡∏µ", "‡∏≠‡∏à.‡∏û‡∏±‡∏ó‡∏ò‡πå‡∏ò‡∏µ‡∏£‡∏≤", "‡∏≠‡∏à.‡∏û‡∏ô‡∏¥‡∏ï‡∏≤", "‡∏≠‡∏à.‡∏≠‡∏±‡∏á‡∏®‡∏∏‡∏°‡∏≤", "‡∏≠‡∏à.‡∏ß‡∏á‡∏®‡∏Å‡∏£", "‡∏≠‡∏à.‡∏™‡∏∏‡∏†‡∏±‡∏ó‡∏£‡∏≤"];
    let allSelections = [];
    let currentGroupId = "";
    let temp1 = "";
    let temp2 = "";

    // ‡∏£‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
    window.onload = loadOnlineData;

    // 1. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏ß‡∏≤‡∏î Dashboard
    async function loadOnlineData() {
        const dashboard = document.getElementById('dashboard');
        dashboard.innerHTML = "<h3 style='color: #f39c12;'>‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</h3>";

        try {
            const response = await fetch(SCRIPT_URL);
            if (!response.ok) throw new Error("Network response was not ok");
            const data = await response.json();

            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            if (!Array.isArray(data) || data.length <= 1) {
                dashboard.innerHTML = "<h3 style='color: #7f8c8d;'>üì≠ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏î‡πÜ</h3>";
                allSelections = [];
                renderDashboard();
                return;
            }

            // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 1 ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏õ (‡∏Ç‡πâ‡∏≤‡∏°‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á)
            allSelections = data.slice(1).map(row => ({
                group: row[1] ? row[1].toString() : "",
                choice1: row[2] || "",
                choice2: row[3] || ""
            })).filter(s => s.group !== "");

            renderDashboard();

        } catch (e) {
            dashboard.innerHTML = `<h3 style="color: #e74c3c;">‚ùå ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö SCRIPT_URL</h3>`;
            console.error(e);
        }
    }

    // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏≠‡∏≤‡∏à‡∏≤‡∏£‡∏¢‡πå
    function renderDashboard() {
        const container = document.getElementById('dashboard');
        if(allSelections.length === 0) return; // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏ö‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏à‡πâ‡∏á‡∏ß‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
        
        container.innerHTML = "";
        ajarnList.forEach(name => {
            const choices1 = allSelections.filter(s => s.choice1 === name);
            const choices2 = allSelections.filter(s => s.choice2 === name);
            
            const box = document.createElement('div');
            box.className = 'stat-box';
            
            let html = `<div class="stat-name">${name}</div>`;
            
            if (choices1.length > 0) {
                html += `<div class="section-1"><small style="color:#e74c3c; font-weight:bold;">ü•á ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 1:</small><br> ${choices1.map(s => `<span class="group-tag">‡∏Å‡∏•‡∏∏‡πà‡∏° ${s.group}</span>`).join
    <script  src="./script.js"></script>

  </body>
  
</html>
